<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>wcWebCamClient lib: theora_test/input_strm/main.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxy.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="wclogo_c.svg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">wcWebCamClient lib
   &#160;<span id="projectnumber">v0.8.2</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('theora_test_2input_strm_2main_8cpp-example.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">theora_test/input_strm/main.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/*===============================================================*/</span></div>
<div class="line"><span class="comment">/* This is an example of how to use the wcWebCamClient library.  */</span></div>
<div class="line"><span class="comment">/* Simple class for parsing command line                         */</span></div>
<div class="line"><span class="comment">/* commandline_tools.h                                           */</span></div>
<div class="line"><span class="comment">/*                                                               */</span></div>
<div class="line"><span class="comment">/* Part of wcWebCamClient library project                        */</span></div>
<div class="line"><span class="comment">/*                                                               */</span></div>
<div class="line"><span class="comment">/* Copyright 2022 Ilya Medvedkov                                 */</span></div>
<div class="line"><span class="comment">/*===============================================================*/</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifndef COMMLINE_TOOLS_H_INCLUDED</span></div>
<div class="line"><span class="preprocessor">#define COMMLINE_TOOLS_H_INCLUDED</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>InputParser{</div>
<div class="line">    <span class="keyword">public</span>:</div>
<div class="line">        InputParser (<span class="keywordtype">int</span> &amp;argc, <span class="keywordtype">char</span> **argv){</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=1; i &lt; argc; ++i)</div>
<div class="line">                this-&gt;tokens.push_back(std::string(argv[i]));</div>
<div class="line">        }</div>
<div class="line">        <span class="keyword">const</span> std::string&amp; getCmdOption(<span class="keyword">const</span> std::string &amp;option)<span class="keyword"> const</span>{</div>
<div class="line">            std::vector&lt;std::string&gt;::const_iterator itr;</div>
<div class="line">            itr =  std::find(this-&gt;tokens.begin(), this-&gt;tokens.end(), option);</div>
<div class="line">            <span class="keywordflow">if</span> (itr != this-&gt;tokens.end() &amp;&amp; ++itr != this-&gt;tokens.end()){</div>
<div class="line">                <span class="keywordflow">return</span> *itr;</div>
<div class="line">            }</div>
<div class="line">            <span class="keyword">static</span> <span class="keyword">const</span> std::string empty_string(<span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">            <span class="keywordflow">return</span> empty_string;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordtype">bool</span> cmdOptionExists(<span class="keyword">const</span> std::string &amp;option)<span class="keyword"> const</span>{</div>
<div class="line">            <span class="keywordflow">return</span> std::find(this-&gt;tokens.begin(), this-&gt;tokens.end(), option)</div>
<div class="line">                   != this-&gt;tokens.end();</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> std::string&amp; getHost() {</div>
<div class="line">            <span class="keyword">static</span> <span class="keyword">const</span> std::string CMD_HOST(<span class="stringliteral">&quot;--host&quot;</span>);</div>
<div class="line">            <span class="keyword">static</span> <span class="keyword">const</span> std::string CMD_HOST_SYN(<span class="stringliteral">&quot;-u&quot;</span>);</div>
<div class="line">            <span class="keyword">const</span> std::string &amp; res = getCmdOption(CMD_HOST);</div>
<div class="line">            <span class="keywordflow">if</span> (res.empty()) {</div>
<div class="line">                <span class="keywordflow">return</span> getCmdOption(CMD_HOST_SYN);</div>
<div class="line">            } <span class="keywordflow">else</span></div>
<div class="line">                <span class="keywordflow">return</span> res;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> std::string&amp; getProxy() {</div>
<div class="line">            <span class="keyword">static</span> <span class="keyword">const</span> std::string CMD_PROXY(<span class="stringliteral">&quot;--proxy&quot;</span>);</div>
<div class="line">            <span class="keyword">static</span> <span class="keyword">const</span> std::string CMD_PROXY_SYN(<span class="stringliteral">&quot;-p&quot;</span>);</div>
<div class="line">            <span class="keyword">const</span> std::string &amp; res = getCmdOption(CMD_PROXY);</div>
<div class="line">            <span class="keywordflow">if</span> (res.empty()) {</div>
<div class="line">                <span class="keywordflow">return</span> getCmdOption(CMD_PROXY_SYN);</div>
<div class="line">            } <span class="keywordflow">else</span></div>
<div class="line">                <span class="keywordflow">return</span> res;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> std::string&amp; getDevice() {</div>
<div class="line">            <span class="keyword">static</span> <span class="keyword">const</span> std::string CMD_DEVICE(<span class="stringliteral">&quot;--device&quot;</span>);</div>
<div class="line">            <span class="keyword">static</span> <span class="keyword">const</span> std::string CMD_DEVICE_SYN(<span class="stringliteral">&quot;-d&quot;</span>);</div>
<div class="line">            <span class="keyword">const</span> std::string &amp; res = getCmdOption(CMD_DEVICE);</div>
<div class="line">            <span class="keywordflow">if</span> (res.empty()) {</div>
<div class="line">                <span class="keywordflow">return</span> getCmdOption(CMD_DEVICE_SYN);</div>
<div class="line">            } <span class="keywordflow">else</span></div>
<div class="line">                <span class="keywordflow">return</span> res;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> std::string&amp; getUserName() {</div>
<div class="line">            <span class="keyword">static</span> <span class="keyword">const</span> std::string CMD_USER_NAME(<span class="stringliteral">&quot;--name&quot;</span>);</div>
<div class="line">            <span class="keyword">static</span> <span class="keyword">const</span> std::string CMD_USER_NAME_SYN(<span class="stringliteral">&quot;-n&quot;</span>);</div>
<div class="line">            <span class="keyword">const</span> std::string &amp; res = getCmdOption(CMD_USER_NAME);</div>
<div class="line">            <span class="keywordflow">if</span> (res.empty()) {</div>
<div class="line">                <span class="keywordflow">return</span> getCmdOption(CMD_USER_NAME_SYN);</div>
<div class="line">            } <span class="keywordflow">else</span></div>
<div class="line">                <span class="keywordflow">return</span> res;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> std::string&amp; getUserPassword() {</div>
<div class="line">            <span class="keyword">static</span> <span class="keyword">const</span> std::string CMD_USER_PWRD(<span class="stringliteral">&quot;--pwrd&quot;</span>);</div>
<div class="line">            <span class="keyword">static</span> <span class="keyword">const</span> std::string CMD_USER_PWRD_SYN(<span class="stringliteral">&quot;-x&quot;</span>);</div>
<div class="line">            <span class="keyword">const</span> std::string &amp; res = getCmdOption(CMD_USER_PWRD);</div>
<div class="line">            <span class="keywordflow">if</span> (res.empty()) {</div>
<div class="line">                <span class="keywordflow">return</span> getCmdOption(CMD_USER_PWRD_SYN);</div>
<div class="line">            } <span class="keywordflow">else</span></div>
<div class="line">                <span class="keywordflow">return</span> res;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">bool</span> ignoreTLSCert() {</div>
<div class="line">            <span class="keyword">static</span> <span class="keyword">const</span> std::string OPT_TLS_IGNORE(<span class="stringliteral">&quot;-k&quot;</span>);</div>
<div class="line">            <span class="keywordflow">return</span> cmdOptionExists(OPT_TLS_IGNORE);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">bool</span> showHelp() {</div>
<div class="line">            <span class="keyword">static</span> <span class="keyword">const</span> std::string OPT_SHOW_HELP(<span class="stringliteral">&quot;-h&quot;</span>);</div>
<div class="line">            <span class="keywordflow">return</span> cmdOptionExists(OPT_SHOW_HELP);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">virtual</span> <span class="keywordtype">void</span> printCommonHelp() {</div>
<div class="line">            <span class="keywordflow">if</span> (tokens.size() &gt; 0)</div>
<div class="line">                std::cout &lt;&lt; <span class="stringliteral">&quot;Usage:&quot;</span> &lt;&lt; tokens.at(0) &lt;&lt; <span class="stringliteral">&quot; [options...]&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot; -u, --host       URL for server host in format https://hostname:port&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot; -p, --proxy      Proxy in format [[username][:password]@][proxyurl:port]&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot; -d, --device     Device name&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot; -n, --name       Login name&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot; -x, --pwrd       Login password&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot; -k               Ignore TLS certificate errors&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot; -h               Show this help&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        }</div>
<div class="line">    <span class="keyword">private</span>:</div>
<div class="line">        std::vector &lt;std::string&gt; tokens;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">// COMMLINE_TOOLS_H_INCLUDED</span></div>
</div><!-- fragment --><p>This is an example of how to use the wcWebCamClient library. A simple test program to demonstrate input streaming.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="comment">/*===============================================================*/</span></div>
<div class="line"><span class="comment">/* This is an example of how to use the wcWebCamClient library.  */</span></div>
<div class="line"><span class="comment">/* In this example, a client is created, authorized on the       */</span></div>
<div class="line"><span class="comment">/* server, and starts listening to streaming from selected input */</span></div>
<div class="line"><span class="comment">/* device. All frames of then incoming stream are encoded in     */</span></div>
<div class="line"><span class="comment">/* Theora format and saved as an .OGV output file.               */</span></div>
<div class="line"><span class="comment">/*                                                               */</span></div>
<div class="line"><span class="comment">/* Part of wcWebCamClient library project                        */</span></div>
<div class="line"><span class="comment">/*                                                               */</span></div>
<div class="line"><span class="comment">/* Copyright 2022 Ilya Medvedkov                                 */</span></div>
<div class="line"><span class="comment">/*===============================================================*</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> The example uses code from the Theora project (test png2theora).</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment"> https://github.com/xiph/theora/blob/master/examples/png2theora.c</span></div>
<div class="line"><span class="comment"> *****************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="wcwebcamclient_8h.html">wcwebcamclient.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;chrono&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;thread&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;math.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;wcJSON.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;png.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;ogg/ogg.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;theora/theoraenc.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;../../commline_tools.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span>std;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* The total program timeout in seconds */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> uint32_t TIME_OUT = 60;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">size_t</span> MAX_INPUT_BUFFER = 0x7D000;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> uint8_t running = 0;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> ofstream outfile;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> * mem_frame_buffer = NULL;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">size_t</span> frame_size = 0;</div>
<div class="line"><span class="keyword">static</span> std::string input_device;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> theora_initialized = <span class="keyword">false</span>;</div>
<div class="line"><span class="keyword">static</span> th_ycbcr_buffer ycbcr;</div>
<div class="line"><span class="keyword">static</span> uint32_t video_fps_numerator = 24;</div>
<div class="line"><span class="keyword">static</span> uint32_t video_fps_denominator = 1;</div>
<div class="line"><span class="keyword">static</span> uint32_t video_aspect_numerator = 0;</div>
<div class="line"><span class="keyword">static</span> uint32_t video_aspect_denominator = 0;</div>
<div class="line"><span class="keyword">static</span> uint32_t discrete_delta = 300;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> soft_target = <span class="keyword">false</span>;</div>
<div class="line"><span class="comment">/* if video_rate &gt; 0 : soft_target = true and encoder flags configure to use</span></div>
<div class="line"><span class="comment">   the video_rate value */</span></div>
<div class="line"><span class="keyword">static</span> uint32_t video_rate = 0;</div>
<div class="line"><span class="comment">/* if video_rate == 0 : soft_target = false */</span></div>
<div class="line"><span class="keyword">static</span> uint32_t video_quality = 25;</div>
<div class="line">ogg_uint32_t keyframe_frequency=64;</div>
<div class="line"><span class="keyword">static</span> th_pixel_fmt chroma_format = TH_PF_420;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> ogg_stream_state ogg_os;</div>
<div class="line"><span class="keyword">static</span> ogg_packet op;</div>
<div class="line"><span class="keyword">static</span> ogg_page og;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> th_enc_ctx      *td = NULL;</div>
<div class="line"><span class="keyword">static</span> th_info          ti;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> uint8_t clamp(<span class="keywordtype">int</span> d)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span>(d &lt; 0)</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span>(d &gt; 255)</div>
<div class="line">        <span class="keywordflow">return</span> 255;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> d;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> ilog(<span class="keywordtype">unsigned</span> _v)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ret;</div>
<div class="line">    <span class="keywordflow">for</span>(ret=0; _v; ret++)</div>
<div class="line">        _v&gt;&gt;=1;</div>
<div class="line">    <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Covert the png rgb data to the ycbcr buffer</span></div>
<div class="line"><span class="comment">   src: xiph/theora/blob/master/examples/png2theora.c */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> rgb_to_yuv(png_bytep *png,</div>
<div class="line">                        th_ycbcr_buffer ycbcr,</div>
<div class="line">                        uint32_t w, uint32_t h)</div>
<div class="line">{</div>
<div class="line">    uint32_t x;</div>
<div class="line">    uint32_t y;</div>
<div class="line"> </div>
<div class="line">    uint32_t x1;</div>
<div class="line">    uint32_t y1;</div>
<div class="line"> </div>
<div class="line">    uint64_t yuv_w;</div>
<div class="line"> </div>
<div class="line">    uint8_t *yuv_y;</div>
<div class="line">    uint8_t *yuv_u;</div>
<div class="line">    uint8_t *yuv_v;</div>
<div class="line"> </div>
<div class="line">    yuv_w = ycbcr[0].width;</div>
<div class="line"> </div>
<div class="line">    yuv_y = ycbcr[0].data;</div>
<div class="line">    yuv_u = ycbcr[1].data;</div>
<div class="line">    yuv_v = ycbcr[2].data;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/*This ignores gamma and RGB primary/whitepoint differences.</span></div>
<div class="line"><span class="comment">      It also isn&#39;t terribly fast (though a decent compiler will</span></div>
<div class="line"><span class="comment">      strength-reduce the division to a multiplication).*/</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (chroma_format == TH_PF_420)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">for</span>(y = 0; y &lt; h; y += 2)</div>
<div class="line">        {</div>
<div class="line">            y1=y+(y+1&lt;h);</div>
<div class="line">            <span class="keywordflow">for</span>(x = 0; x &lt; w; x += 2)</div>
<div class="line">            {</div>
<div class="line">                x1=x+(x+1&lt;w);</div>
<div class="line">                png_byte r0 = png[y][3 * x + 0];</div>
<div class="line">                png_byte g0 = png[y][3 * x + 1];</div>
<div class="line">                png_byte b0 = png[y][3 * x + 2];</div>
<div class="line">                png_byte r1 = png[y][3 * x1 + 0];</div>
<div class="line">                png_byte g1 = png[y][3 * x1 + 1];</div>
<div class="line">                png_byte b1 = png[y][3 * x1 + 2];</div>
<div class="line">                png_byte r2 = png[y1][3 * x + 0];</div>
<div class="line">                png_byte g2 = png[y1][3 * x + 1];</div>
<div class="line">                png_byte b2 = png[y1][3 * x + 2];</div>
<div class="line">                png_byte r3 = png[y1][3 * x1 + 0];</div>
<div class="line">                png_byte g3 = png[y1][3 * x1 + 1];</div>
<div class="line">                png_byte b3 = png[y1][3 * x1 + 2];</div>
<div class="line"> </div>
<div class="line">                yuv_y[x  + y * yuv_w]  = clamp((65481*r0+128553*g0+24966*b0+4207500)/255000);</div>
<div class="line">                yuv_y[x1 + y * yuv_w]  = clamp((65481*r1+128553*g1+24966*b1+4207500)/255000);</div>
<div class="line">                yuv_y[x  + y1 * yuv_w] = clamp((65481*r2+128553*g2+24966*b2+4207500)/255000);</div>
<div class="line">                yuv_y[x1 + y1 * yuv_w] = clamp((65481*r3+128553*g3+24966*b3+4207500)/255000);</div>
<div class="line"> </div>
<div class="line">                yuv_u[(x &gt;&gt; 1) + (y &gt;&gt; 1) * ycbcr[1].stride] =</div>
<div class="line">                    clamp( ((-33488*r0-65744*g0+99232*b0+29032005)/4 +</div>
<div class="line">                            (-33488*r1-65744*g1+99232*b1+29032005)/4 +</div>
<div class="line">                            (-33488*r2-65744*g2+99232*b2+29032005)/4 +</div>
<div class="line">                            (-33488*r3-65744*g3+99232*b3+29032005)/4)/225930);</div>
<div class="line">                yuv_v[(x &gt;&gt; 1) + (y &gt;&gt; 1) * ycbcr[2].stride] =</div>
<div class="line">                    clamp( ((157024*r0-131488*g0-25536*b0+45940035)/4 +</div>
<div class="line">                            (157024*r1-131488*g1-25536*b1+45940035)/4 +</div>
<div class="line">                            (157024*r2-131488*g2-25536*b2+45940035)/4 +</div>
<div class="line">                            (157024*r3-131488*g3-25536*b3+45940035)/4)/357510);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (chroma_format == TH_PF_444)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">for</span>(y = 0; y &lt; h; y++)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">for</span>(x = 0; x &lt; w; x++)</div>
<div class="line">            {</div>
<div class="line">                png_byte r = png[y][3 * x + 0];</div>
<div class="line">                png_byte g = png[y][3 * x + 1];</div>
<div class="line">                png_byte b = png[y][3 * x + 2];</div>
<div class="line"> </div>
<div class="line">                yuv_y[x + y * yuv_w] = clamp((65481*r+128553*g+24966*b+4207500)/255000);</div>
<div class="line">                yuv_u[x + y * yuv_w] = clamp((-33488*r-65744*g+99232*b+29032005)/225930);</div>
<div class="line">                yuv_v[x + y * yuv_w] = clamp((157024*r-131488*g-25536*b+45940035)/357510);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span>      <span class="comment">/* TH_PF_422 */</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">for</span>(y = 0; y &lt; h; y += 1)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">for</span>(x = 0; x &lt; w; x += 2)</div>
<div class="line">            {</div>
<div class="line">                x1=x+(x+1&lt;w);</div>
<div class="line">                png_byte r0 = png[y][3 * x + 0];</div>
<div class="line">                png_byte g0 = png[y][3 * x + 1];</div>
<div class="line">                png_byte b0 = png[y][3 * x + 2];</div>
<div class="line">                png_byte r1 = png[y][3 * x1 + 0];</div>
<div class="line">                png_byte g1 = png[y][3 * x1 + 1];</div>
<div class="line">                png_byte b1 = png[y][3 * x1 + 2];</div>
<div class="line"> </div>
<div class="line">                yuv_y[x  + y * yuv_w] = clamp((65481*r0+128553*g0+24966*b0+4207500)/255000);</div>
<div class="line">                yuv_y[x1 + y * yuv_w] = clamp((65481*r1+128553*g1+24966*b1+4207500)/255000);</div>
<div class="line"> </div>
<div class="line">                yuv_u[(x &gt;&gt; 1) + y * ycbcr[1].stride] =</div>
<div class="line">                    clamp( ((-33488*r0-65744*g0+99232*b0+29032005)/2 +</div>
<div class="line">                            (-33488*r1-65744*g1+99232*b1+29032005)/2)/225930);</div>
<div class="line">                yuv_v[(x &gt;&gt; 1) + y * ycbcr[2].stride] =</div>
<div class="line">                    clamp( ((157024*r0-131488*g0-25536*b0+45940035)/2 +</div>
<div class="line">                            (157024*r1-131488*g1-25536*b1+45940035)/2)/357510);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>mem_file</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> *buf;</div>
<div class="line">    <span class="keywordtype">size_t</span> size;</div>
<div class="line">    <span class="keywordtype">size_t</span> cur;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> mem_read(png_structp png_ptr, png_bytep buf, png_size_t sz)</div>
<div class="line">{</div>
<div class="line">    mem_file * stream = (mem_file*)png_get_io_ptr(png_ptr);</div>
<div class="line">    <span class="keywordtype">size_t</span> cp = sz;</div>
<div class="line">    <span class="keywordflow">if</span> ((cp + stream-&gt;cur) &gt; stream-&gt;size)</div>
<div class="line">    {</div>
<div class="line">        cp = stream-&gt;size - stream-&gt;cur;</div>
<div class="line">    }</div>
<div class="line">    memcpy(buf, &amp;(stream-&gt;buf[stream-&gt;cur]), cp);</div>
<div class="line">    stream-&gt;cur += cp;</div>
<div class="line">    <span class="keywordflow">if</span> (cp != sz)</div>
<div class="line">        png_error(png_ptr, <span class="stringliteral">&quot;Read Error&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Load PNG data from frame</span></div>
<div class="line"><span class="comment">   src: xiph/theora/blob/master/examples/png2theora.c */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> png_read(<span class="keyword">const</span> <span class="keywordtype">void</span> * buffer,</div>
<div class="line">                    <span class="keywordtype">size_t</span> buflen,</div>
<div class="line">                    uint32_t *w, uint32_t *h,</div>
<div class="line">                    th_ycbcr_buffer ycbcr)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> * fp = (<span class="keywordtype">char</span> *) buffer + <a name="a0"></a><a class="code" href="wcwebcamclient_8h.html#a941706cde2f229a3253a772a2a0598db">WC_STREAM_FRAME_HEADER_SIZE</a>;</div>
<div class="line">    buflen -= <a class="code" href="wcwebcamclient_8h.html#a941706cde2f229a3253a772a2a0598db">WC_STREAM_FRAME_HEADER_SIZE</a>;</div>
<div class="line">    uint8_t header[8];</div>
<div class="line">    png_structp png_ptr;</div>
<div class="line">    png_infop info_ptr;</div>
<div class="line">    png_infop end_ptr;</div>
<div class="line">    png_bytep row_data;</div>
<div class="line">    png_bytep *row_pointers;</div>
<div class="line">    png_color_16p bkgd;</div>
<div class="line">    png_uint_32 width;</div>
<div class="line">    png_uint_32 height;</div>
<div class="line">    uint64_t yuv_w;</div>
<div class="line">    uint64_t yuv_h;</div>
<div class="line">    <span class="keywordtype">int</span> bit_depth;</div>
<div class="line">    <span class="keywordtype">int</span> color_type;</div>
<div class="line">    <span class="keywordtype">int</span> interlace_type;</div>
<div class="line">    <span class="keywordtype">int</span> compression_type;</div>
<div class="line">    <span class="keywordtype">int</span> filter_method;</div>
<div class="line">    png_uint_32 y;</div>
<div class="line"> </div>
<div class="line">    memcpy(header, fp, 8);</div>
<div class="line">    <span class="keywordflow">if</span>(png_sig_cmp(header, 0, 8))</div>
<div class="line">    {</div>
<div class="line">        cerr &lt;&lt; <span class="stringliteral">&quot;error:not a PNG&quot;</span> &lt;&lt; endl;</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    png_ptr = png_create_read_struct(PNG_LIBPNG_VER_STRING,</div>
<div class="line">                                     NULL, NULL, NULL);</div>
<div class="line">    <span class="keywordflow">if</span>(!png_ptr)</div>
<div class="line">    {</div>
<div class="line">        cerr &lt;&lt; <span class="stringliteral">&quot;error: couldn&#39;t create png read structure&quot;</span> &lt;&lt; endl;</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    info_ptr = png_create_info_struct(png_ptr);</div>
<div class="line">    <span class="keywordflow">if</span>(!info_ptr)</div>
<div class="line">    {</div>
<div class="line">        cerr &lt;&lt; <span class="stringliteral">&quot;error:  couldn&#39;t create png info structure&quot;</span> &lt;&lt; endl;</div>
<div class="line">        png_destroy_read_struct(&amp;png_ptr, NULL, NULL);</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    end_ptr = png_create_info_struct(png_ptr);</div>
<div class="line">    <span class="keywordflow">if</span>(!end_ptr)</div>
<div class="line">    {</div>
<div class="line">        cerr &lt;&lt; <span class="stringliteral">&quot;error: couldn&#39;t create png info structure&quot;</span> &lt;&lt; endl;</div>
<div class="line">        png_destroy_read_struct(&amp;png_ptr, &amp;info_ptr, NULL);</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>mem_file f = { .buf = fp, .size = buflen, .cur = 8 };</div>
<div class="line">    png_set_read_fn(png_ptr, &amp;f, mem_read);</div>
<div class="line">    png_set_sig_bytes(png_ptr, 8);</div>
<div class="line">    png_read_info(png_ptr, info_ptr);</div>
<div class="line">    png_get_IHDR(png_ptr, info_ptr, &amp;width, &amp;height, &amp;bit_depth, &amp;color_type,</div>
<div class="line">                 &amp;interlace_type, &amp;compression_type, &amp;filter_method);</div>
<div class="line">    png_set_expand(png_ptr);</div>
<div class="line">    <span class="keywordflow">if</span>(bit_depth&lt;8)</div>
<div class="line">        png_set_packing(png_ptr);</div>
<div class="line">    <span class="keywordflow">if</span>(bit_depth==16)</div>
<div class="line">        png_set_strip_16(png_ptr);</div>
<div class="line">    <span class="keywordflow">if</span>(!(color_type&amp;PNG_COLOR_MASK_COLOR))</div>
<div class="line">        png_set_gray_to_rgb(png_ptr);</div>
<div class="line">    <span class="keywordflow">if</span>(png_get_bKGD(png_ptr, info_ptr, &amp;bkgd))</div>
<div class="line">    {</div>
<div class="line">        png_set_background(png_ptr, bkgd, PNG_BACKGROUND_GAMMA_FILE, 1, 1.0);</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">/*Note that color_type 2 and 3 can also have alpha, despite not setting the</span></div>
<div class="line"><span class="comment">       PNG_COLOR_MASK_ALPHA bit.</span></div>
<div class="line"><span class="comment">      We always strip it to prevent libpng from overrunning our buffer.*/</span></div>
<div class="line">    png_set_strip_alpha(png_ptr);</div>
<div class="line"> </div>
<div class="line">    row_data = (png_bytep)png_malloc(png_ptr,</div>
<div class="line">                                     3*height*width*<span class="keyword">sizeof</span>(*row_data));</div>
<div class="line">    row_pointers = (png_bytep *)png_malloc(png_ptr,</div>
<div class="line">                                           height*<span class="keyword">sizeof</span>(*row_pointers));</div>
<div class="line">    <span class="keywordflow">for</span>(y = 0; y &lt; height; y++)</div>
<div class="line">    {</div>
<div class="line">        row_pointers[y] = row_data + y*(3*width);</div>
<div class="line">    }</div>
<div class="line">    png_read_image(png_ptr, row_pointers);</div>
<div class="line">    png_read_end(png_ptr, end_ptr);</div>
<div class="line"> </div>
<div class="line">    *w = width;</div>
<div class="line">    *h = height;</div>
<div class="line">    <span class="comment">/* Must hold: yuv_w &gt;= w */</span></div>
<div class="line">    yuv_w = (*w + 15) &amp; ~15;</div>
<div class="line">    <span class="comment">/* Must hold: yuv_h &gt;= h */</span></div>
<div class="line">    yuv_h = (*h + 15) &amp; ~15;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Do we need to allocate a buffer */</span></div>
<div class="line">    <span class="keywordflow">if</span> (!ycbcr[0].data)</div>
<div class="line">    {</div>
<div class="line">        ycbcr[0].width = yuv_w;</div>
<div class="line">        ycbcr[0].height = yuv_h;</div>
<div class="line">        ycbcr[0].stride = yuv_w;</div>
<div class="line">        ycbcr[1].width = (chroma_format == TH_PF_444) ? yuv_w : (yuv_w &gt;&gt; 1);</div>
<div class="line">        ycbcr[1].stride = ycbcr[1].width;</div>
<div class="line">        ycbcr[1].height = (chroma_format == TH_PF_420) ? (yuv_h &gt;&gt; 1) : yuv_h;</div>
<div class="line">        ycbcr[2].width = ycbcr[1].width;</div>
<div class="line">        ycbcr[2].stride = ycbcr[1].stride;</div>
<div class="line">        ycbcr[2].height = ycbcr[1].height;</div>
<div class="line"> </div>
<div class="line">        ycbcr[0].data = (uint8_t*) malloc(ycbcr[0].stride * ycbcr[0].height);</div>
<div class="line">        ycbcr[1].data = (uint8_t*) malloc(ycbcr[1].stride * ycbcr[1].height);</div>
<div class="line">        ycbcr[2].data = (uint8_t*) malloc(ycbcr[2].stride * ycbcr[2].height);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> ((ycbcr[0].width != (int64_t)yuv_w) || (ycbcr[0].height != (int64_t)yuv_h))</div>
<div class="line">        {</div>
<div class="line">            cerr &lt;&lt; <span class="stringliteral">&quot;Input size &quot;</span> &lt;&lt; yuv_w &lt;&lt; <span class="stringliteral">&quot;x&quot;</span> &lt;&lt; yuv_h &lt;&lt;</div>
<div class="line">                    <span class="stringliteral">&quot; does not match &quot;</span> &lt;&lt; ycbcr[0].width &lt;&lt; <span class="stringliteral">&quot;x&quot;</span> &lt;&lt; ycbcr[0].height &lt;&lt; endl;</div>
<div class="line">            <span class="keywordflow">return</span> 1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    rgb_to_yuv(row_pointers, ycbcr, *w, *h);</div>
<div class="line"> </div>
<div class="line">    png_free(png_ptr, row_pointers);</div>
<div class="line">    png_free(png_ptr, row_data);</div>
<div class="line">    png_destroy_read_struct(&amp;png_ptr, &amp;info_ptr, &amp;end_ptr);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Initialize the Theora encoder</span></div>
<div class="line"><span class="comment">   src: xiph/theora/blob/master/examples/png2theora.c */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> theora_init(uint32_t w, uint32_t h)</div>
<div class="line">{</div>
<div class="line">    srand(time(NULL));</div>
<div class="line">    <span class="keywordflow">if</span> (ogg_stream_init(&amp;ogg_os, rand()))</div>
<div class="line">    {</div>
<div class="line">        cerr &lt;&lt; <span class="stringliteral">&quot;error: couldn&#39;t create ogg stream state&quot;</span> &lt;&lt; endl;</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (discrete_delta &gt; 0) {</div>
<div class="line">        video_fps_numerator = 1000 / discrete_delta;</div>
<div class="line">        keyframe_frequency = video_fps_numerator * 2 + 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    th_info_init(&amp;ti);</div>
<div class="line">    ti.frame_width = ((w + 15) &gt;&gt;4)&lt;&lt;4;</div>
<div class="line">    ti.frame_height = ((h + 15)&gt;&gt;4)&lt;&lt;4;</div>
<div class="line">    ti.pic_width = w;</div>
<div class="line">    ti.pic_height = h;</div>
<div class="line">    ti.pic_x = 0;</div>
<div class="line">    ti.pic_y = 0;</div>
<div class="line">    ti.fps_numerator = video_fps_numerator;</div>
<div class="line">    ti.fps_denominator = video_fps_denominator;</div>
<div class="line">    ti.aspect_numerator = video_aspect_numerator;</div>
<div class="line">    ti.aspect_denominator = video_aspect_denominator;</div>
<div class="line">    ti.colorspace = TH_CS_UNSPECIFIED;</div>
<div class="line">    ti.pixel_fmt = chroma_format;</div>
<div class="line">    ti.target_bitrate = video_rate;</div>
<div class="line">    ti.quality = video_quality;</div>
<div class="line">    ti.keyframe_granule_shift=ilog(keyframe_frequency-1);</div>
<div class="line">    td=th_encode_alloc(&amp;ti);</div>
<div class="line">    th_info_clear(&amp;ti);</div>
<div class="line">    <span class="comment">/* setting just the granule shift only allows power-of-two keyframe</span></div>
<div class="line"><span class="comment">       spacing.  Set the actual requested spacing. */</span></div>
<div class="line">    <span class="keywordtype">int</span> ret = th_encode_ctl(td,TH_ENCCTL_SET_KEYFRAME_FREQUENCY_FORCE,</div>
<div class="line">                            &amp;keyframe_frequency,</div>
<div class="line">                            <span class="keyword">sizeof</span>(keyframe_frequency - 1));</div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line">        cerr &lt;&lt; <span class="stringliteral">&quot;Could not set keyframe interval to &quot;</span> &lt;&lt; (int)keyframe_frequency &lt;&lt; endl;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (soft_target) {</div>
<div class="line">        <span class="comment">/* reverse the rate control flags to favor a &#39;long time&#39; strategy */</span></div>
<div class="line">        <span class="keywordtype">int</span> arg = TH_RATECTL_CAP_UNDERFLOW;</div>
<div class="line">        ret=th_encode_ctl(td,TH_ENCCTL_SET_RATE_FLAGS,&amp;arg,<span class="keyword">sizeof</span>(arg));</div>
<div class="line">        <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line">            cerr &lt;&lt; <span class="stringliteral">&quot;Could not set encoder flags for --soft-target&quot;</span> &lt;&lt; endl;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Default buffer control is overridden on two-pass */</span></div>
<div class="line">        <span class="keywordflow">if</span>((keyframe_frequency*7&gt;&gt;1) &gt; 5*video_fps_numerator/video_fps_denominator)</div>
<div class="line">            arg = keyframe_frequency * 7 &gt;&gt; 1;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            arg = 5 * video_fps_numerator/video_fps_denominator;</div>
<div class="line">        ret = th_encode_ctl(td,TH_ENCCTL_SET_RATE_BUFFER,&amp;arg,<span class="keyword">sizeof</span>(arg));</div>
<div class="line">        <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line">            cerr &lt;&lt; <span class="stringliteral">&quot;Could not set rate control buffer for --soft-target&quot;</span> &lt;&lt; endl;</div>
<div class="line">    }</div>
<div class="line">    th_comment       tc;</div>
<div class="line">    <span class="comment">/* write the bitstream header packets with proper page interleave */</span></div>
<div class="line">    th_comment_init(&amp;tc);</div>
<div class="line">    <span class="comment">/* first packet will get its own page automatically */</span></div>
<div class="line">    <span class="keywordflow">if</span> (th_encode_flushheader(td,&amp;tc,&amp;op) &lt;= 0) {</div>
<div class="line">        cerr &lt;&lt; <span class="stringliteral">&quot;Internal Theora library error&quot;</span> &lt;&lt; endl;</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">    th_comment_clear(&amp;tc);</div>
<div class="line">    ogg_stream_packetin(&amp;ogg_os,&amp;op);</div>
<div class="line">    <span class="keywordflow">if</span>(ogg_stream_pageout(&amp;ogg_os,&amp;og)!=1) {</div>
<div class="line">        cerr &lt;&lt; <span class="stringliteral">&quot;Internal Ogg library error&quot;</span> &lt;&lt; endl;</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">    outfile.write((<span class="keyword">const</span> <span class="keywordtype">char</span> *)og.header,og.header_len);</div>
<div class="line">    outfile.write((<span class="keyword">const</span> <span class="keywordtype">char</span> *)og.body,og.body_len);</div>
<div class="line">    <span class="comment">/* create the remaining theora headers */</span></div>
<div class="line">    <span class="keywordflow">for</span>(;;)</div>
<div class="line">    {</div>
<div class="line">        ret=th_encode_flushheader(td,&amp;tc,&amp;op);</div>
<div class="line">        <span class="keywordflow">if</span>(ret&lt;0)</div>
<div class="line">        {</div>
<div class="line">            cerr &lt;&lt; <span class="stringliteral">&quot;Internal Theora library error&quot;</span> &lt;&lt; endl;</div>
<div class="line">            <span class="keywordflow">return</span> 1;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!ret)</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        ogg_stream_packetin(&amp;ogg_os,&amp;op);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">for</span>(;;)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">int</span> result = ogg_stream_flush(&amp;ogg_os,&amp;og);</div>
<div class="line">        <span class="keywordflow">if</span> (result &lt; 0) {</div>
<div class="line">            <span class="comment">/* can&#39;t get here */</span></div>
<div class="line">            cerr &lt;&lt; <span class="stringliteral">&quot;Internal Ogg library error&quot;</span> &lt;&lt; endl;</div>
<div class="line">            <span class="keywordflow">return</span> 1;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (result == 0)</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        outfile.write((<span class="keyword">const</span> <span class="keywordtype">char</span> *)og.header,og.header_len);</div>
<div class="line">        outfile.write((<span class="keyword">const</span> <span class="keywordtype">char</span> *)og.body,og.body_len);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    theora_initialized = <span class="keyword">true</span>;</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Encode and write the new Theora frame</span></div>
<div class="line"><span class="comment">   src: xiph/theora/blob/master/examples/png2theora.c */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> theora_write_frame(th_ycbcr_buffer ycbcr, <span class="keywordtype">int</span> last)</div>
<div class="line">{</div>
<div class="line">    ogg_packet op;</div>
<div class="line">    ogg_page og;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span>(th_encode_ycbcr_in(td, ycbcr))</div>
<div class="line">    {</div>
<div class="line">        cerr &lt;&lt; <span class="stringliteral">&quot;error: could not encode frame&quot;</span> &lt;&lt; endl;</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span>(!th_encode_packetout(td, last, &amp;op))</div>
<div class="line">    {</div>
<div class="line">        cerr &lt;&lt; <span class="stringliteral">&quot;error: could not read packets&quot;</span> &lt;&lt; endl;</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    ogg_stream_packetin(&amp;ogg_os, &amp;op);</div>
<div class="line">    <span class="keywordflow">while</span> (ogg_stream_pageout(&amp;ogg_os, &amp;og))</div>
<div class="line">    {</div>
<div class="line">        outfile.write((<span class="keyword">const</span> <span class="keywordtype">char</span> *)og.header, og.header_len);</div>
<div class="line">        outfile.write((<span class="keyword">const</span> <span class="keywordtype">char</span> *)og.body, og.body_len);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Callback. CURL was initialized successfully. */</span></div>
<div class="line"><span class="keywordtype">void</span> onCURLinit(<a class="code" href="wcwebcamclient_8h.html#a8ed09f7b448a852b96e2a705531a285c">wcHandle</a> <span class="keyword">self</span>, <a class="code" href="wcwebcamclient_8h.html#a91c112d47f81589bb3ead6630798b831">wcTask</a> task)</div>
<div class="line">{</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;CURL initialized&quot;</span> &lt;&lt; endl;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Callback. Authorization was successful. */</span></div>
<div class="line"><span class="keywordtype">void</span> onAuth(<a class="code" href="wcwebcamclient_8h.html#a8ed09f7b448a852b96e2a705531a285c">wcHandle</a> <span class="keyword">self</span>, <a class="code" href="wcwebcamclient_8h.html#a91c112d47f81589bb3ead6630798b831">wcTask</a> task)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> * res = NULL;</div>
<div class="line">    <span class="comment">/* Get a new session id and display it on the screen. */</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a name="a1"></a><a class="code" href="group__wc_client_getters_setters.html#ga441981a02cd8ff1a42f87253f2eadc9b">wcClientGetStrValue</a>(<span class="keyword">self</span>, <a name="a2"></a><a class="code" href="group__wc_client_getters_setters.html#ggadfaa57b72e59d00fa03e0a1fd5ff4c5aab1459f27a26ce8e6b2a7b3ad90bc87aa">wcstSID</a>, &amp;res) == <a name="a3"></a><a class="code" href="group__wc_return.html#ga5f50c11b25339e1568bf54e5c4027418">WC_OK</a>)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (res)</div>
<div class="line">        {</div>
<div class="line">            cout &lt;&lt; res &lt;&lt; endl;</div>
<div class="line">            free(res);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    running = 2;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Callback. The client has been disabled. */</span></div>
<div class="line"><span class="keywordtype">void</span> onDisconnect(<a class="code" href="wcwebcamclient_8h.html#a8ed09f7b448a852b96e2a705531a285c">wcHandle</a> <span class="keyword">self</span>, <a class="code" href="wcwebcamclient_8h.html#a91c112d47f81589bb3ead6630798b831">wcTask</a> task)</div>
<div class="line">{</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Client disconnected&quot;</span> &lt;&lt; endl;</div>
<div class="line">    running = 10;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Callback. Connection state changed. */</span></div>
<div class="line"><span class="keywordtype">void</span> onConnChanged(<a class="code" href="wcwebcamclient_8h.html#a8ed09f7b448a852b96e2a705531a285c">wcHandle</a> <span class="keyword">self</span>, <span class="keywordtype">int</span> state)</div>
<div class="line">{</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Client connection changed &quot;</span> &lt;&lt; state &lt;&lt; endl;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Callback. Log was changed. */</span></div>
<div class="line"><span class="keywordtype">void</span> onLog(<a class="code" href="wcwebcamclient_8h.html#a8ed09f7b448a852b96e2a705531a285c">wcHandle</a> <span class="keyword">self</span>, <span class="keyword">const</span> <span class="keywordtype">char</span> * str)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Display new log entry. */</span></div>
<div class="line">    cout &lt;&lt; str &lt;&lt; endl;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">string</span> cDEVICE(<span class="stringliteral">&quot;device&quot;</span>);</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">string</span> cSUBPROTO(<span class="stringliteral">&quot;subproto&quot;</span>);</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">string</span> cDELTA(<span class="stringliteral">&quot;delta&quot;</span>);</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">string</span> RAW_PNG_PROTO(<span class="stringliteral">&quot;RAW_PNG&quot;</span>);</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> device_online = <span class="keyword">false</span>;</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> device_streaming = <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Callback. A device list has changed. */</span></div>
<div class="line"><span class="keywordtype">void</span> onDevicesUpdated(<a class="code" href="wcwebcamclient_8h.html#a8ed09f7b448a852b96e2a705531a285c">wcHandle</a> <span class="keyword">self</span>, <a class="code" href="wcwebcamclient_8h.html#a91c112d47f81589bb3ead6630798b831">wcTask</a> tsk, <span class="keyword">const</span> <span class="keywordtype">char</span> * json)</div>
<div class="line">{</div>
<div class="line">    wcJSON jarr(json);</div>
<div class="line">    <span class="keywordflow">if</span> (jarr.isArray()) {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; jarr.length(); i++) {</div>
<div class="line">            wcJSON obj = jarr.getArrayItem(i);</div>
<div class="line">            <span class="keywordflow">if</span> (obj.isObject()) {</div>
<div class="line">                wcJSON name = obj.getObjItem(cDEVICE.c_str());</div>
<div class="line">                <span class="keywordflow">if</span> (name.isString() &amp;&amp; (input_device.compare(name.valueString()) == 0)) {</div>
<div class="line">                    device_online = <span class="keyword">true</span>;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (device_online &amp;&amp; device_streaming)</div>
<div class="line">        running = 4;</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">        running = 2;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Callback. A streams list has changed. */</span></div>
<div class="line"><span class="keywordtype">void</span> onStreamsUpdated(<a class="code" href="wcwebcamclient_8h.html#a8ed09f7b448a852b96e2a705531a285c">wcHandle</a> <span class="keyword">self</span>, <a class="code" href="wcwebcamclient_8h.html#a91c112d47f81589bb3ead6630798b831">wcTask</a> tsk, <span class="keyword">const</span> <span class="keywordtype">char</span> * json)</div>
<div class="line">{</div>
<div class="line">    wcJSON jarr(json);</div>
<div class="line">    <span class="keywordflow">if</span> (jarr.isArray()) {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; jarr.length(); i++) {</div>
<div class="line">            wcJSON obj = jarr.getArrayItem(i);</div>
<div class="line">            <span class="keywordflow">if</span> (obj.isObject()) {</div>
<div class="line">                wcJSON name = obj.getObjItem(cDEVICE.c_str());</div>
<div class="line">                <span class="keywordflow">if</span> (name.isString() &amp;&amp; (input_device.compare(name.valueString()) == 0)) {</div>
<div class="line">                    wcJSON subproto = obj.getObjItem(cSUBPROTO.c_str());</div>
<div class="line">                    <span class="keywordflow">if</span> (subproto.isString() &amp;&amp; (RAW_PNG_PROTO.compare(subproto.valueString())== 0)) {</div>
<div class="line">                        device_streaming = <span class="keyword">true</span>;</div>
<div class="line">                        wcJSON delta = obj.getObjItem(cDELTA.c_str());</div>
<div class="line">                        <span class="keywordflow">if</span> (delta.isNumber()) {</div>
<div class="line">                            discrete_delta = delta.valueInt();</div>
<div class="line">                            <span class="keywordflow">if</span> (discrete_delta &lt; 200) discrete_delta = 200;</div>
<div class="line">                        }</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (device_online &amp;&amp; device_streaming)</div>
<div class="line">        running = 4;</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">        running = 2;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Callback. IO stream closed. */</span></div>
<div class="line"><span class="keywordtype">void</span> onIOTaskFinished(<a class="code" href="wcwebcamclient_8h.html#a8ed09f7b448a852b96e2a705531a285c">wcHandle</a> client, <a class="code" href="wcwebcamclient_8h.html#a91c112d47f81589bb3ead6630798b831">wcTask</a> tsk)</div>
<div class="line">{</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Input stream closed&quot;</span> &lt;&lt; endl;</div>
<div class="line">    running = 10;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Callback. IO stream started. */</span></div>
<div class="line"><span class="keywordtype">void</span> onIOTaskStarted(<a class="code" href="wcwebcamclient_8h.html#a8ed09f7b448a852b96e2a705531a285c">wcHandle</a> client, <a class="code" href="wcwebcamclient_8h.html#a91c112d47f81589bb3ead6630798b831">wcTask</a> tsk)</div>
<div class="line">{</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Input stream started&quot;</span> &lt;&lt; endl;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Callback. Task updated. */</span></div>
<div class="line"><span class="keywordtype">void</span> onTaskSynchronized(<a class="code" href="wcwebcamclient_8h.html#a8ed09f7b448a852b96e2a705531a285c">wcHandle</a> client, <a class="code" href="wcwebcamclient_8h.html#a91c112d47f81589bb3ead6630798b831">wcTask</a> tsk)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="wcwebcamclient_8h.html#ae1ba77ff9ed951c2384f2564b6680760">wcTaskClass</a> tcid = <a name="a4"></a><a class="code" href="wcwebcamclient_8h.html#a6a8ac7634cc4a78caa52e83769a914c2">WC_BASE_TASK</a>;</div>
<div class="line">    <span class="comment">/* Get the class for `tsk` */</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a name="a5"></a><a class="code" href="group__wc_tasks_funcs.html#ga07eee37da8ec74d384f07e43eb0eb3c1">wcTaskGetClass</a>(tsk, &amp;tcid) == <a class="code" href="group__wc_return.html#ga5f50c11b25339e1568bf54e5c4027418">WC_OK</a>) {</div>
<div class="line">        <span class="keywordflow">if</span> (tcid == <a name="a6"></a><a class="code" href="wcwebcamclient_8h.html#a75f2ee25f8849ec1859b53ecc06bbff6">WC_IN_STREAM_TASK</a>) {</div>
<div class="line">            <span class="comment">/* The input stream task updated (the new frame has incoming)  */</span></div>
<div class="line">            frame_size = MAX_INPUT_BUFFER;</div>
<div class="line">            <a name="a7"></a><a class="code" href="group__wc_in_tasks_funcs.html#gaac040def5a25b7fe708a86f2ddf43c4f">wcInTaskPopFrame</a>(tsk, (<span class="keywordtype">void</span>**)&amp;mem_frame_buffer, &amp;frame_size);</div>
<div class="line"> </div>
<div class="line">            uint32_t w, h;</div>
<div class="line">            <span class="comment">/* Read frame as png-image  */</span></div>
<div class="line">            <span class="keywordflow">if</span> (png_read(mem_frame_buffer, frame_size, &amp;w, &amp;h, ycbcr)) {</div>
<div class="line">                cerr &lt;&lt; <span class="stringliteral">&quot;Could not read frame&quot;</span> &lt;&lt; endl;</div>
<div class="line">                running = 10;</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (!theora_initialized) {</div>
<div class="line">                <span class="comment">/* Initialize Theora encoder  */</span></div>
<div class="line">                <span class="keywordflow">if</span> (theora_init(w, h)) {</div>
<div class="line">                    cerr &lt;&lt; <span class="stringliteral">&quot;Could not init theora encoder&quot;</span> &lt;&lt; endl;</div>
<div class="line">                    running = 10;</div>
<div class="line">                    <span class="keywordflow">return</span>;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="comment">/* Write next Theora frame  */</span></div>
<div class="line">            <span class="keywordflow">if</span> (theora_write_frame(ycbcr, 0)) {</div>
<div class="line">                cerr &lt;&lt; <span class="stringliteral">&quot;Encoding error&quot;</span> &lt;&lt; endl;</div>
<div class="line">                running = 10;</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>MyInputParser : <span class="keyword">public</span> InputParser</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">using</span> InputParser::InputParser;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> std::string&amp; getInput()</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">static</span> <span class="keyword">const</span> std::string CMD_INPUT(<span class="stringliteral">&quot;--input&quot;</span>);</div>
<div class="line">        <span class="keyword">static</span> <span class="keyword">const</span> std::string CMD_INPUT_SYN(<span class="stringliteral">&quot;-i&quot;</span>);</div>
<div class="line">        <span class="keyword">const</span> std::string &amp; res = getCmdOption(CMD_INPUT);</div>
<div class="line">        <span class="keywordflow">if</span> (res.empty())</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">return</span> getCmdOption(CMD_INPUT_SYN);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            <span class="keywordflow">return</span> res;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> std::string&amp; getOutput()</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">static</span> <span class="keyword">const</span> std::string CMD_OUTPUT(<span class="stringliteral">&quot;--output&quot;</span>);</div>
<div class="line">        <span class="keyword">static</span> <span class="keyword">const</span> std::string CMD_OUTPUT_SYN(<span class="stringliteral">&quot;-o&quot;</span>);</div>
<div class="line">        <span class="keyword">const</span> std::string &amp; res = getCmdOption(CMD_OUTPUT);</div>
<div class="line">        <span class="keywordflow">if</span> (res.empty())</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">return</span> getCmdOption(CMD_OUTPUT_SYN);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            <span class="keywordflow">return</span> res;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> getVideoQuality()</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">static</span> <span class="keyword">const</span> std::string CMD_VIDEOQ(<span class="stringliteral">&quot;--video-quality&quot;</span>);</div>
<div class="line">        <span class="keyword">static</span> <span class="keyword">const</span> std::string CMD_VIDEOQ_SYN(<span class="stringliteral">&quot;-v&quot;</span>);</div>
<div class="line">        std::string res = getCmdOption(CMD_VIDEOQ);</div>
<div class="line">        <span class="keywordflow">if</span> (res.empty())</div>
<div class="line">            res = getCmdOption(CMD_VIDEOQ_SYN);</div>
<div class="line">        <span class="keywordtype">int</span> vq;</div>
<div class="line">        <span class="keywordflow">if</span> (!res.empty()) {</div>
<div class="line">            vq = rint(atof(res.c_str())*6.3);</div>
<div class="line">            <span class="keywordflow">if</span> (vq&lt;0 || vq&gt;63){</div>
<div class="line">                cerr &lt;&lt; <span class="stringliteral">&quot;Illegal video quality (choose 0 through 10)&quot;</span> &lt;&lt; endl;</div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line">            }</div>
<div class="line">        } <span class="keywordflow">else</span> vq = 25;</div>
<div class="line">        <span class="keywordflow">return</span> vq;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> getVideoRate()</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">static</span> <span class="keyword">const</span> std::string CMD_VIDEOR(<span class="stringliteral">&quot;--video-rate&quot;</span>);</div>
<div class="line">        <span class="keyword">static</span> <span class="keyword">const</span> std::string CMD_VIDEOR_SYN(<span class="stringliteral">&quot;-V&quot;</span>);</div>
<div class="line">        std::string res = getCmdOption(CMD_VIDEOR);</div>
<div class="line">        <span class="keywordflow">if</span> (res.empty())</div>
<div class="line">            res = getCmdOption(CMD_VIDEOR_SYN);</div>
<div class="line">        <span class="keywordtype">int</span> vq;</div>
<div class="line">        <span class="keywordflow">if</span> (!res.empty()) {</div>
<div class="line">            vq = atoi(res.c_str()) * 1024;</div>
<div class="line">        } <span class="keywordflow">else</span> vq = 0;</div>
<div class="line">        <span class="keywordflow">return</span> vq;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> th_pixel_fmt getChroma()</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">static</span> <span class="keyword">const</span> std::string CMD_CHROMA(<span class="stringliteral">&quot;--chroma&quot;</span>);</div>
<div class="line">        <span class="keyword">const</span> std::string &amp; res = getCmdOption(CMD_CHROMA);</div>
<div class="line">        th_pixel_fmt vq;</div>
<div class="line">        <span class="keywordflow">if</span> (!res.empty()) {</div>
<div class="line">            <span class="keywordtype">int</span> vqv = atoi(res.c_str());</div>
<div class="line">            <span class="keywordflow">switch</span> (vqv) {</div>
<div class="line">                <span class="keywordflow">case</span> 444 : vq = TH_PF_444;</div>
<div class="line">                           <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> 422 : vq = TH_PF_422;</div>
<div class="line">                           <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> 420 : vq = TH_PF_420;</div>
<div class="line">                           <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">default</span>:</div>
<div class="line">                    cerr &lt;&lt; <span class="stringliteral">&quot;Illegal chroma subsampling: &quot;</span> &lt;&lt; vqv &lt;&lt; endl;</div>
<div class="line">                    vq = TH_PF_420;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        } <span class="keywordflow">else</span> vq = TH_PF_420;</div>
<div class="line">        <span class="keywordflow">return</span> vq;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> printCommonHelp()<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        InputParser::printCommonHelp();</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;  -i --input &lt;devicename&gt;         the device name to get data stream from (required);&quot;</span> &lt;&lt; endl;</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;  -o --output &lt;filename.ogv&gt;      file name for encoded output (required);&quot;</span> &lt;&lt; endl;</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;  -v --video-quality &lt;n&gt;          Theora quality selector from 0 to 10&quot;</span> &lt;&lt; endl;</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;                                  (0 yields smallest files but lowest&quot;</span> &lt;&lt; endl;</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;                                  video quality. 10 yields highest&quot;</span> &lt;&lt; endl;</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;                                  fidelity but large files)&quot;</span> &lt;&lt; endl;</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;  -V --video-rate &lt;n&gt;             bitrate target for Theora video in kbits per second&quot;</span> &lt;&lt; endl;</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;                                  Use a large reservoir and treat the rate&quot;</span> &lt;&lt; endl;</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;                                  as a soft target; rate control is less&quot;</span> &lt;&lt; endl;</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;                                  strict but resulting quality is usually&quot;</span> &lt;&lt; endl;</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;                                  higher/smoother overall. Soft target also&quot;</span> &lt;&lt; endl;</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;                                  allows an optional -v setting to specify&quot;</span> &lt;&lt; endl;</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;                                  a minimum allowed quality.&quot;</span> &lt;&lt; endl;</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;  --chroma {444|422|420}          Use 4:4:4 chroma subsampling&quot;</span> &lt;&lt; endl;</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;                                  Use 4:2:2 chroma subsampling&quot;</span> &lt;&lt; endl;</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;                                  (4:2:0 is default)&quot;</span> &lt;&lt; endl;</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> * argv[])</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Parse command line */</span></div>
<div class="line">    MyInputParser input(argc, argv);</div>
<div class="line">    <span class="keyword">const</span> std::string &amp;host = input.getHost();</div>
<div class="line">    <span class="keyword">const</span> std::string &amp;proxy = input.getProxy();</div>
<div class="line">    <span class="keyword">const</span> std::string &amp;user = input.getUserName();</div>
<div class="line">    <span class="keyword">const</span> std::string &amp;pwrd = input.getUserPassword();</div>
<div class="line">    std::string device = input.getDevice();</div>
<div class="line">    <span class="keywordflow">if</span> (device.empty())</div>
<div class="line">        device = <span class="stringliteral">&quot;device_test001_input&quot;</span>;</div>
<div class="line">    input_device = input.getInput();</div>
<div class="line">    <span class="keywordflow">if</span> (input_device.empty())</div>
<div class="line">        input_device = <span class="stringliteral">&quot;device_test001_output&quot;</span>;</div>
<div class="line">    std::string output_file = input.getOutput();</div>
<div class="line">    <span class="keywordflow">if</span> (output_file.empty())</div>
<div class="line">        output_file = <span class="stringliteral">&quot;output.ogv&quot;</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (input.showHelp())</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Show help doc */</span></div>
<div class="line">        input.printCommonHelp();</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    outfile = ofstream(output_file, ios::out | ios::trunc | ios::binary);</div>
<div class="line">    <span class="keywordflow">if</span> (!outfile.is_open())</div>
<div class="line">    {</div>
<div class="line">        cerr &lt;&lt; <span class="stringliteral">&quot;Can&#39;t open output file. Wrong file name or the file is blocked: &quot;</span> &lt;&lt; output_file &lt;&lt; endl;</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    chroma_format = input.getChroma();</div>
<div class="line">    video_quality = input.getVideoQuality();</div>
<div class="line">    video_rate = input.getVideoRate();</div>
<div class="line">    <span class="keywordflow">if</span> (video_rate &gt; 0) { soft_target = <span class="keyword">true</span>; }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!host.empty())</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Main part */</span></div>
<div class="line">        <a class="code" href="wcwebcamclient_8h.html#a8ed09f7b448a852b96e2a705531a285c">wcHandle</a> client = <a name="a8"></a><a class="code" href="group__wc_client_life_circle.html#ga6ff7e5cc74e848c1fd7b051332423e64">wcClientCreate</a>();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Configure certificate */</span></div>
<div class="line">        <span class="keywordflow">if</span> (input.ignoreTLSCert())</div>
<div class="line">            <a name="a9"></a><a class="code" href="group__wc_client_getters_setters.html#gaab079cd91a9e20e518cede6593cf9448">wcClientSetBoolState</a>(client, <a name="a10"></a><a class="code" href="group__wc_client_getters_setters.html#ggadfaa57b72e59d00fa03e0a1fd5ff4c5aad394968a9441b19a5e30987b72364027">wcstVerifyTLS</a>, <a name="a11"></a><a class="code" href="group__wc_return.html#ga8d8feb58e6ee2a2bb9a6e16e1a38b537">WC_FALSE</a>);</div>
<div class="line">        <span class="comment">/* Configure proxy */</span></div>
<div class="line">        <span class="keywordflow">if</span> (!proxy.empty())</div>
<div class="line">            <a name="a12"></a><a class="code" href="group__wc_client_getters_setters.html#ga6c38e3cd94cad66481252e8b933244d5">wcClientSetStrValue</a>(client, <a name="a13"></a><a class="code" href="group__wc_client_getters_setters.html#ggadfaa57b72e59d00fa03e0a1fd5ff4c5aabd9990c1a582ffb5883bb2d25be1bac8">wcstProxy</a>, proxy.c_str());</div>
<div class="line">        <span class="comment">/* Configure host */</span></div>
<div class="line">        <a class="code" href="group__wc_client_getters_setters.html#ga6c38e3cd94cad66481252e8b933244d5">wcClientSetStrValue</a>(client, <a name="a14"></a><a class="code" href="group__wc_client_getters_setters.html#ggadfaa57b72e59d00fa03e0a1fd5ff4c5aad2e69ee46e5e09f64d858cfc32d84e71">wcstHostName</a>, host.c_str());</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Configure callbacks */</span></div>
<div class="line">        <a name="a15"></a><a class="code" href="group__wc_client_callbacks.html#ga236c9ab837587b20b0ff7633da2d8a99">wcSetTaskCallback</a>(client, <a name="a16"></a><a class="code" href="group__wc_client_callbacks.html#ggaa0654287d510e9750e0293d6d27758b2a75ab4237c20dc9903443885ea5179125">wccbkSuccessAuth</a>, onAuth);</div>
<div class="line">        <a name="a17"></a><a class="code" href="group__wc_client_callbacks.html#ga8620a24ec871f07776cad99b0482c1de">wcSetCStringCallback</a>(client, <a name="a18"></a><a class="code" href="group__wc_client_callbacks.html#ggaa0654287d510e9750e0293d6d27758b2a0bb165e7d967922ab898bbaec010616f">wccbkAddLog</a>, onLog);</div>
<div class="line">        <a name="a19"></a><a class="code" href="group__wc_client_callbacks.html#ga484a3470a41431b547c03e262f9740ae">wcSetNotifyCallback</a>(client, <a name="a20"></a><a class="code" href="group__wc_client_callbacks.html#ggaa0654287d510e9750e0293d6d27758b2a68767c5dd04b5f6808cb33ad15015d28">wccbkInitCURL</a>, onCURLinit);</div>
<div class="line">        <a class="code" href="group__wc_client_callbacks.html#ga484a3470a41431b547c03e262f9740ae">wcSetNotifyCallback</a>(client, <a name="a21"></a><a class="code" href="group__wc_client_callbacks.html#ggaa0654287d510e9750e0293d6d27758b2abc6003d6b3b869de905cf70bde94d88a">wccbkDisconnect</a>, onDisconnect);</div>
<div class="line">        <a name="a22"></a><a class="code" href="group__wc_client_callbacks.html#gaff423ec577d1f989d5b958d037f1e1dd">wcSetConnCallback</a>(client, onConnChanged);</div>
<div class="line">        <span class="comment">/* Configure task callbacks */</span></div>
<div class="line">        <a name="a23"></a><a class="code" href="group__wc_client_callbacks.html#gaf8c6d2bfd06c4984e990744e7fa8b7cd">wcSetJSONStrCallback</a>(client, <a name="a24"></a><a class="code" href="group__wc_client_callbacks.html#ggaa0654287d510e9750e0293d6d27758b2aa9a41198e5947fb6b1143c1c51e22299">wccbkSuccessUpdateDevices</a>, onDevicesUpdated);</div>
<div class="line">        <a class="code" href="group__wc_client_callbacks.html#gaf8c6d2bfd06c4984e990744e7fa8b7cd">wcSetJSONStrCallback</a>(client, <a name="a25"></a><a class="code" href="group__wc_client_callbacks.html#ggaa0654287d510e9750e0293d6d27758b2acd9882ae8575f5e4a7b3f85751c319a8">wccbkSuccessUpdateStreams</a>, onStreamsUpdated);</div>
<div class="line">        <span class="comment">/* Configure streaming callbacks */</span></div>
<div class="line">        <a class="code" href="group__wc_client_callbacks.html#ga236c9ab837587b20b0ff7633da2d8a99">wcSetTaskCallback</a>(client, <a name="a26"></a><a class="code" href="group__wc_client_callbacks.html#ggaa0654287d510e9750e0293d6d27758b2a17acb2489b43f54a9b3f8e9f7ab3ccda">wccbkAfterLaunchInStream</a>, onIOTaskStarted);</div>
<div class="line">        <a class="code" href="group__wc_client_callbacks.html#ga236c9ab837587b20b0ff7633da2d8a99">wcSetTaskCallback</a>(client, <a name="a27"></a><a class="code" href="group__wc_client_callbacks.html#ggaa0654287d510e9750e0293d6d27758b2a167e248df079d152ee639b9480ebd1b4">wccbkSynchroUpdateTask</a>, onTaskSynchronized);</div>
<div class="line">        <a class="code" href="group__wc_client_callbacks.html#ga236c9ab837587b20b0ff7633da2d8a99">wcSetTaskCallback</a>(client, <a name="a28"></a><a class="code" href="group__wc_client_callbacks.html#ggaa0654287d510e9750e0293d6d27758b2aae551be528f4ee38a12c10d679c609b8">wccbkSuccessIOStream</a>, onIOTaskFinished);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Start client */</span></div>
<div class="line">        <a name="a29"></a><a class="code" href="group__wc_client_life_circle.html#gac94074404959f8afb6b61d98d12ce67f">wcClientStart</a>(client);</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">auto</span> start_timestamp = std::chrono::system_clock::now();</div>
<div class="line">        <span class="keywordflow">while</span> (running &lt; 8)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">switch</span> (running)</div>
<div class="line">            {</div>
<div class="line">            <span class="keywordflow">case</span> 0:</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">/* Authorize client */</span></div>
<div class="line">                <a class="code" href="group__wc_client_getters_setters.html#ga6c38e3cd94cad66481252e8b933244d5">wcClientSetStrValue</a>(client, <a name="a30"></a><a class="code" href="group__wc_client_getters_setters.html#ggadfaa57b72e59d00fa03e0a1fd5ff4c5aa82a89872b009222639406f7a906b261d">wcstDeviceName</a>, device.c_str());</div>
<div class="line">                <a name="a31"></a><a class="code" href="group__wc_client_life_circle.html#gaa7063345c0553e273627b0674b11f2fa">wcClientAuth</a>(client, user.c_str(), pwrd.c_str());</div>
<div class="line">                running = 1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">case</span> 2:</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">/* Start to search online devices and streams */</span></div>
<div class="line">                <a name="a32"></a><a class="code" href="group__wc_client_getters_setters.html#ga5476168bb021a854c39f3d7cf4c8bd22">wcClientInvalidateState</a>(client, <a name="a33"></a><a class="code" href="group__wc_client_getters_setters.html#ggadfaa57b72e59d00fa03e0a1fd5ff4c5aa07f6f3cd860c1b8db2d3fab001d4f176">wcstDevices</a>);</div>
<div class="line">                <a class="code" href="group__wc_client_getters_setters.html#ga5476168bb021a854c39f3d7cf4c8bd22">wcClientInvalidateState</a>(client, <a name="a34"></a><a class="code" href="group__wc_client_getters_setters.html#ggadfaa57b72e59d00fa03e0a1fd5ff4c5aa23994f253f4746232e1803519d171356">wcstStreams</a>);</div>
<div class="line">                running = 3;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">case</span> 4:</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">/* Allocate buffer */</span></div>
<div class="line">                mem_frame_buffer = (<span class="keywordtype">char</span>*)malloc(MAX_INPUT_BUFFER);</div>
<div class="line">                ycbcr[0].data = 0;</div>
<div class="line">                <span class="comment">/* Start the input stream*/</span></div>
<div class="line">                <a name="a35"></a><a class="code" href="group__wc_client_requests.html#ga297e080f6cbd19a994286d5878e49ea5">wcLaunchInStream</a>(client, input_device.c_str(), NULL);</div>
<div class="line">                running = 5;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">default</span>:</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (running &lt; 5)</div>
<div class="line">                std::this_thread::sleep_for(std::chrono::milliseconds(1000));</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">                std::this_thread::sleep_for(std::chrono::milliseconds(50));</div>
<div class="line">            <span class="comment">/* Proceed client */</span></div>
<div class="line">            <a name="a36"></a><a class="code" href="group__wc_client_life_circle.html#ga9bb2d3d2d30f80e6efef2b39a528ace0">wcClientProceed</a>(client);</div>
<div class="line">            <a name="a37"></a><a class="code" href="group__wc_client_life_circle.html#ga7da1194c4e90fb9a2aa63d4c872f141f">wcClientTasksProceed</a>(client);</div>
<div class="line"> </div>
<div class="line">            <span class="keyword">auto</span> current_timestamp = std::chrono::system_clock::now();</div>
<div class="line">            <span class="keyword">auto</span> int_s = chrono::duration_cast&lt;chrono::seconds&gt;(current_timestamp - start_timestamp);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (int_s.count() &gt;= TIME_OUT) {</div>
<div class="line">                cout &lt;&lt; <span class="stringliteral">&quot;timeout&quot;</span> &lt;&lt; endl;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">/* Disconnect client */</span></div>
<div class="line">        <a name="a38"></a><a class="code" href="group__wc_client_life_circle.html#ga938e623d526f8a4b6f0f84bba1898c89">wcClientDisconnect</a>(client);</div>
<div class="line">        <span class="comment">/* Destroy client */</span></div>
<div class="line">        <a name="a39"></a><a class="code" href="group__wc_client_life_circle.html#gaba5e12008f7d0f3e6e1fee31045b14aa">wcClientDestroy</a>(client);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (mem_frame_buffer)</div>
<div class="line">            free(mem_frame_buffer);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (theora_initialized)</div>
<div class="line">        {</div>
<div class="line">            th_encode_free(td);</div>
<div class="line">            free(ycbcr[0].data);</div>
<div class="line">            free(ycbcr[1].data);</div>
<div class="line">            free(ycbcr[2].data);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span>(ogg_stream_flush(&amp;ogg_os, &amp;og))</div>
<div class="line">            {</div>
<div class="line">                outfile.write((<span class="keyword">const</span> <span class="keywordtype">char</span> *)og.header, og.header_len);</div>
<div class="line">                outfile.write((<span class="keyword">const</span> <span class="keywordtype">char</span> *)og.body, og.body_len);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            outfile.flush();</div>
<div class="line"> </div>
<div class="line">            ogg_stream_clear(&amp;ogg_os);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        outfile.close();</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;should contain at least --host (host-name) option&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="ttc" id="agroup__wc_client_callbacks_html_ga236c9ab837587b20b0ff7633da2d8a99"><div class="ttname"><a href="group__wc_client_callbacks.html#ga236c9ab837587b20b0ff7633da2d8a99">wcSetTaskCallback</a></div><div class="ttdeci">wcRCode DLLEXPORT wcSetTaskCallback(wcHandle client, wcCallback callbackId, TaskNotifyLibFunc func)</div><div class="ttdoc">Set specified task notify callback for client.</div></div>
<div class="ttc" id="agroup__wc_client_callbacks_html_ga484a3470a41431b547c03e262f9740ae"><div class="ttname"><a href="group__wc_client_callbacks.html#ga484a3470a41431b547c03e262f9740ae">wcSetNotifyCallback</a></div><div class="ttdeci">wcRCode DLLEXPORT wcSetNotifyCallback(wcHandle client, wcCallback callbackId, NotifyEventLibFunc func)</div><div class="ttdoc">Set specified notify callback for client.</div></div>
<div class="ttc" id="agroup__wc_client_callbacks_html_ga8620a24ec871f07776cad99b0482c1de"><div class="ttname"><a href="group__wc_client_callbacks.html#ga8620a24ec871f07776cad99b0482c1de">wcSetCStringCallback</a></div><div class="ttdeci">wcRCode DLLEXPORT wcSetCStringCallback(wcHandle client, wcCallback callbackId, CStringNotifyLibFunc func)</div><div class="ttdoc">Set specified notify callback for client to handling the C-style string values.</div></div>
<div class="ttc" id="agroup__wc_client_callbacks_html_gaf8c6d2bfd06c4984e990744e7fa8b7cd"><div class="ttname"><a href="group__wc_client_callbacks.html#gaf8c6d2bfd06c4984e990744e7fa8b7cd">wcSetJSONStrCallback</a></div><div class="ttdeci">wcRCode DLLEXPORT wcSetJSONStrCallback(wcHandle client, wcCallback callbackId, JSONStrNotifyEventLibFunc func)</div><div class="ttdoc">Set specified notify callback for client to process the JSON-formatted response results represented a...</div></div>
<div class="ttc" id="agroup__wc_client_callbacks_html_gaff423ec577d1f989d5b958d037f1e1dd"><div class="ttname"><a href="group__wc_client_callbacks.html#gaff423ec577d1f989d5b958d037f1e1dd">wcSetConnCallback</a></div><div class="ttdeci">wcRCode DLLEXPORT wcSetConnCallback(wcHandle client, ConnNotifyEventLibFunc func)</div><div class="ttdoc">Set specified connection notify callback for client.</div></div>
<div class="ttc" id="agroup__wc_client_callbacks_html_ggaa0654287d510e9750e0293d6d27758b2a0bb165e7d967922ab898bbaec010616f"><div class="ttname"><a href="group__wc_client_callbacks.html#ggaa0654287d510e9750e0293d6d27758b2a0bb165e7d967922ab898bbaec010616f">wccbkAddLog</a></div><div class="ttdeci">@ wccbkAddLog</div><div class="ttdoc">Added new log entry.</div><div class="ttdef"><b>Definition:</b> wcwebcamclient.h:140</div></div>
<div class="ttc" id="agroup__wc_client_callbacks_html_ggaa0654287d510e9750e0293d6d27758b2a167e248df079d152ee639b9480ebd1b4"><div class="ttname"><a href="group__wc_client_callbacks.html#ggaa0654287d510e9750e0293d6d27758b2a167e248df079d152ee639b9480ebd1b4">wccbkSynchroUpdateTask</a></div><div class="ttdeci">@ wccbkSynchroUpdateTask</div><div class="ttdoc">The IO streaming task signals that a change has occurred.</div><div class="ttdef"><b>Definition:</b> wcwebcamclient.h:141</div></div>
<div class="ttc" id="agroup__wc_client_callbacks_html_ggaa0654287d510e9750e0293d6d27758b2a17acb2489b43f54a9b3f8e9f7ab3ccda"><div class="ttname"><a href="group__wc_client_callbacks.html#ggaa0654287d510e9750e0293d6d27758b2a17acb2489b43f54a9b3f8e9f7ab3ccda">wccbkAfterLaunchInStream</a></div><div class="ttdeci">@ wccbkAfterLaunchInStream</div><div class="ttdoc">Incoming stream started.</div><div class="ttdef"><b>Definition:</b> wcwebcamclient.h:144</div></div>
<div class="ttc" id="agroup__wc_client_callbacks_html_ggaa0654287d510e9750e0293d6d27758b2a68767c5dd04b5f6808cb33ad15015d28"><div class="ttname"><a href="group__wc_client_callbacks.html#ggaa0654287d510e9750e0293d6d27758b2a68767c5dd04b5f6808cb33ad15015d28">wccbkInitCURL</a></div><div class="ttdeci">@ wccbkInitCURL</div><div class="ttdoc">Successful initialization of the multiCURL handle.</div><div class="ttdef"><b>Definition:</b> wcwebcamclient.h:135</div></div>
<div class="ttc" id="agroup__wc_client_callbacks_html_ggaa0654287d510e9750e0293d6d27758b2a75ab4237c20dc9903443885ea5179125"><div class="ttname"><a href="group__wc_client_callbacks.html#ggaa0654287d510e9750e0293d6d27758b2a75ab4237c20dc9903443885ea5179125">wccbkSuccessAuth</a></div><div class="ttdeci">@ wccbkSuccessAuth</div><div class="ttdoc">Successful authorization.</div><div class="ttdef"><b>Definition:</b> wcwebcamclient.h:136</div></div>
<div class="ttc" id="agroup__wc_client_callbacks_html_ggaa0654287d510e9750e0293d6d27758b2aa9a41198e5947fb6b1143c1c51e22299"><div class="ttname"><a href="group__wc_client_callbacks.html#ggaa0654287d510e9750e0293d6d27758b2aa9a41198e5947fb6b1143c1c51e22299">wccbkSuccessUpdateDevices</a></div><div class="ttdeci">@ wccbkSuccessUpdateDevices</div><div class="ttdoc">The request to update list of online devices has been completed.</div><div class="ttdef"><b>Definition:</b> wcwebcamclient.h:154</div></div>
<div class="ttc" id="agroup__wc_client_callbacks_html_ggaa0654287d510e9750e0293d6d27758b2aae551be528f4ee38a12c10d679c609b8"><div class="ttname"><a href="group__wc_client_callbacks.html#ggaa0654287d510e9750e0293d6d27758b2aae551be528f4ee38a12c10d679c609b8">wccbkSuccessIOStream</a></div><div class="ttdeci">@ wccbkSuccessIOStream</div><div class="ttdoc">IO stream terminated for some reason.</div><div class="ttdef"><b>Definition:</b> wcwebcamclient.h:146</div></div>
<div class="ttc" id="agroup__wc_client_callbacks_html_ggaa0654287d510e9750e0293d6d27758b2abc6003d6b3b869de905cf70bde94d88a"><div class="ttname"><a href="group__wc_client_callbacks.html#ggaa0654287d510e9750e0293d6d27758b2abc6003d6b3b869de905cf70bde94d88a">wccbkDisconnect</a></div><div class="ttdeci">@ wccbkDisconnect</div><div class="ttdoc">Client has been disconnected.</div><div class="ttdef"><b>Definition:</b> wcwebcamclient.h:138</div></div>
<div class="ttc" id="agroup__wc_client_callbacks_html_ggaa0654287d510e9750e0293d6d27758b2acd9882ae8575f5e4a7b3f85751c319a8"><div class="ttname"><a href="group__wc_client_callbacks.html#ggaa0654287d510e9750e0293d6d27758b2acd9882ae8575f5e4a7b3f85751c319a8">wccbkSuccessUpdateStreams</a></div><div class="ttdeci">@ wccbkSuccessUpdateStreams</div><div class="ttdoc">The request to update list of streaming devices has been completed.</div><div class="ttdef"><b>Definition:</b> wcwebcamclient.h:155</div></div>
<div class="ttc" id="agroup__wc_client_getters_setters_html_ga441981a02cd8ff1a42f87253f2eadc9b"><div class="ttname"><a href="group__wc_client_getters_setters.html#ga441981a02cd8ff1a42f87253f2eadc9b">wcClientGetStrValue</a></div><div class="ttdeci">wcRCode DLLEXPORT wcClientGetStrValue(wcHandle client, wcStateId aStateId, char **aStateVal)</div><div class="ttdoc">Get a C-style string value for the selected client state.</div></div>
<div class="ttc" id="agroup__wc_client_getters_setters_html_ga5476168bb021a854c39f3d7cf4c8bd22"><div class="ttname"><a href="group__wc_client_getters_setters.html#ga5476168bb021a854c39f3d7cf4c8bd22">wcClientInvalidateState</a></div><div class="ttdeci">wcRCode DLLEXPORT wcClientInvalidateState(wcHandle client, wcStateId aStateId)</div><div class="ttdoc">Reset the selected client state.</div></div>
<div class="ttc" id="agroup__wc_client_getters_setters_html_ga6c38e3cd94cad66481252e8b933244d5"><div class="ttname"><a href="group__wc_client_getters_setters.html#ga6c38e3cd94cad66481252e8b933244d5">wcClientSetStrValue</a></div><div class="ttdeci">wcRCode DLLEXPORT wcClientSetStrValue(wcHandle client, wcStateId aStateId, const char *aStateVal)</div><div class="ttdoc">Set a C-style string value to the selected client state.</div></div>
<div class="ttc" id="agroup__wc_client_getters_setters_html_gaab079cd91a9e20e518cede6593cf9448"><div class="ttname"><a href="group__wc_client_getters_setters.html#gaab079cd91a9e20e518cede6593cf9448">wcClientSetBoolState</a></div><div class="ttdeci">wcRCode DLLEXPORT wcClientSetBoolState(wcHandle client, wcStateId aStateId, wcStateVal aStateVal)</div><div class="ttdoc">Set the boolean value to the selected client state.</div></div>
<div class="ttc" id="agroup__wc_client_getters_setters_html_ggadfaa57b72e59d00fa03e0a1fd5ff4c5aa07f6f3cd860c1b8db2d3fab001d4f176"><div class="ttname"><a href="group__wc_client_getters_setters.html#ggadfaa57b72e59d00fa03e0a1fd5ff4c5aa07f6f3cd860c1b8db2d3fab001d4f176">wcstDevices</a></div><div class="ttdeci">@ wcstDevices</div><div class="ttdef"><b>Definition:</b> wcwebcamclient.h:180</div></div>
<div class="ttc" id="agroup__wc_client_getters_setters_html_ggadfaa57b72e59d00fa03e0a1fd5ff4c5aa23994f253f4746232e1803519d171356"><div class="ttname"><a href="group__wc_client_getters_setters.html#ggadfaa57b72e59d00fa03e0a1fd5ff4c5aa23994f253f4746232e1803519d171356">wcstStreams</a></div><div class="ttdeci">@ wcstStreams</div><div class="ttdef"><b>Definition:</b> wcwebcamclient.h:179</div></div>
<div class="ttc" id="agroup__wc_client_getters_setters_html_ggadfaa57b72e59d00fa03e0a1fd5ff4c5aa82a89872b009222639406f7a906b261d"><div class="ttname"><a href="group__wc_client_getters_setters.html#ggadfaa57b72e59d00fa03e0a1fd5ff4c5aa82a89872b009222639406f7a906b261d">wcstDeviceName</a></div><div class="ttdeci">@ wcstDeviceName</div><div class="ttdef"><b>Definition:</b> wcwebcamclient.h:187</div></div>
<div class="ttc" id="agroup__wc_client_getters_setters_html_ggadfaa57b72e59d00fa03e0a1fd5ff4c5aab1459f27a26ce8e6b2a7b3ad90bc87aa"><div class="ttname"><a href="group__wc_client_getters_setters.html#ggadfaa57b72e59d00fa03e0a1fd5ff4c5aab1459f27a26ce8e6b2a7b3ad90bc87aa">wcstSID</a></div><div class="ttdeci">@ wcstSID</div><div class="ttdef"><b>Definition:</b> wcwebcamclient.h:188</div></div>
<div class="ttc" id="agroup__wc_client_getters_setters_html_ggadfaa57b72e59d00fa03e0a1fd5ff4c5aabd9990c1a582ffb5883bb2d25be1bac8"><div class="ttname"><a href="group__wc_client_getters_setters.html#ggadfaa57b72e59d00fa03e0a1fd5ff4c5aabd9990c1a582ffb5883bb2d25be1bac8">wcstProxy</a></div><div class="ttdeci">@ wcstProxy</div><div class="ttdef"><b>Definition:</b> wcwebcamclient.h:190</div></div>
<div class="ttc" id="agroup__wc_client_getters_setters_html_ggadfaa57b72e59d00fa03e0a1fd5ff4c5aad2e69ee46e5e09f64d858cfc32d84e71"><div class="ttname"><a href="group__wc_client_getters_setters.html#ggadfaa57b72e59d00fa03e0a1fd5ff4c5aad2e69ee46e5e09f64d858cfc32d84e71">wcstHostName</a></div><div class="ttdeci">@ wcstHostName</div><div class="ttdef"><b>Definition:</b> wcwebcamclient.h:189</div></div>
<div class="ttc" id="agroup__wc_client_getters_setters_html_ggadfaa57b72e59d00fa03e0a1fd5ff4c5aad394968a9441b19a5e30987b72364027"><div class="ttname"><a href="group__wc_client_getters_setters.html#ggadfaa57b72e59d00fa03e0a1fd5ff4c5aad394968a9441b19a5e30987b72364027">wcstVerifyTLS</a></div><div class="ttdeci">@ wcstVerifyTLS</div><div class="ttdef"><b>Definition:</b> wcwebcamclient.h:175</div></div>
<div class="ttc" id="agroup__wc_client_life_circle_html_ga6ff7e5cc74e848c1fd7b051332423e64"><div class="ttname"><a href="group__wc_client_life_circle.html#ga6ff7e5cc74e848c1fd7b051332423e64">wcClientCreate</a></div><div class="ttdeci">wcHandle DLLEXPORT wcClientCreate()</div><div class="ttdoc">Create client.</div></div>
<div class="ttc" id="agroup__wc_client_life_circle_html_ga7da1194c4e90fb9a2aa63d4c872f141f"><div class="ttname"><a href="group__wc_client_life_circle.html#ga7da1194c4e90fb9a2aa63d4c872f141f">wcClientTasksProceed</a></div><div class="ttdeci">wcRCode DLLEXPORT wcClientTasksProceed(wcHandle client)</div><div class="ttdoc">Call the synchronous client update stage.</div></div>
<div class="ttc" id="agroup__wc_client_life_circle_html_ga938e623d526f8a4b6f0f84bba1898c89"><div class="ttname"><a href="group__wc_client_life_circle.html#ga938e623d526f8a4b6f0f84bba1898c89">wcClientDisconnect</a></div><div class="ttdeci">wcRCode DLLEXPORT wcClientDisconnect(wcHandle client)</div><div class="ttdoc">Disconnect client from the server host.</div></div>
<div class="ttc" id="agroup__wc_client_life_circle_html_ga9bb2d3d2d30f80e6efef2b39a528ace0"><div class="ttname"><a href="group__wc_client_life_circle.html#ga9bb2d3d2d30f80e6efef2b39a528ace0">wcClientProceed</a></div><div class="ttdeci">wcRCode DLLEXPORT wcClientProceed(wcHandle client)</div><div class="ttdoc">Call the asynchronous client update stage.</div></div>
<div class="ttc" id="agroup__wc_client_life_circle_html_gaa7063345c0553e273627b0674b11f2fa"><div class="ttname"><a href="group__wc_client_life_circle.html#gaa7063345c0553e273627b0674b11f2fa">wcClientAuth</a></div><div class="ttdeci">wcRCode DLLEXPORT wcClientAuth(wcHandle client, const char *aLogin, const char *aPwrd)</div><div class="ttdoc">Authorize client on the server host.</div></div>
<div class="ttc" id="agroup__wc_client_life_circle_html_gaba5e12008f7d0f3e6e1fee31045b14aa"><div class="ttname"><a href="group__wc_client_life_circle.html#gaba5e12008f7d0f3e6e1fee31045b14aa">wcClientDestroy</a></div><div class="ttdeci">wcRCode DLLEXPORT wcClientDestroy(wcHandle client)</div><div class="ttdoc">Destroy client.</div></div>
<div class="ttc" id="agroup__wc_client_life_circle_html_gac94074404959f8afb6b61d98d12ce67f"><div class="ttname"><a href="group__wc_client_life_circle.html#gac94074404959f8afb6b61d98d12ce67f">wcClientStart</a></div><div class="ttdeci">wcRCode DLLEXPORT wcClientStart(wcHandle client)</div><div class="ttdoc">Launch client.</div></div>
<div class="ttc" id="agroup__wc_client_requests_html_ga297e080f6cbd19a994286d5878e49ea5"><div class="ttname"><a href="group__wc_client_requests.html#ga297e080f6cbd19a994286d5878e49ea5">wcLaunchInStream</a></div><div class="ttdeci">wcRCode DLLEXPORT wcLaunchInStream(wcHandle client, const char *deviceName, void *data)</div><div class="ttdoc">Launch task to consume incoming stream from the specified device for authorized client.</div></div>
<div class="ttc" id="agroup__wc_in_tasks_funcs_html_gaac040def5a25b7fe708a86f2ddf43c4f"><div class="ttname"><a href="group__wc_in_tasks_funcs.html#gaac040def5a25b7fe708a86f2ddf43c4f">wcInTaskPopFrame</a></div><div class="ttdeci">wcRCode DLLEXPORT wcInTaskPopFrame(wcTask task, void **data, size_t *len)</div><div class="ttdoc">Get access to the first frame in the incoming data stack.</div></div>
<div class="ttc" id="agroup__wc_return_html_ga5f50c11b25339e1568bf54e5c4027418"><div class="ttname"><a href="group__wc_return.html#ga5f50c11b25339e1568bf54e5c4027418">WC_OK</a></div><div class="ttdeci">const wcRCode WC_OK</div><div class="ttdef"><b>Definition:</b> wcwebcamclient.h:74</div></div>
<div class="ttc" id="agroup__wc_return_html_ga8d8feb58e6ee2a2bb9a6e16e1a38b537"><div class="ttname"><a href="group__wc_return.html#ga8d8feb58e6ee2a2bb9a6e16e1a38b537">WC_FALSE</a></div><div class="ttdeci">const wcRCode WC_FALSE</div><div class="ttdef"><b>Definition:</b> wcwebcamclient.h:71</div></div>
<div class="ttc" id="agroup__wc_tasks_funcs_html_ga07eee37da8ec74d384f07e43eb0eb3c1"><div class="ttname"><a href="group__wc_tasks_funcs.html#ga07eee37da8ec74d384f07e43eb0eb3c1">wcTaskGetClass</a></div><div class="ttdeci">wcRCode DLLEXPORT wcTaskGetClass(wcTask task, wcTaskClass *id)</div><div class="ttdoc">Get the class of the task.</div></div>
<div class="ttc" id="awcwebcamclient_8h_html"><div class="ttname"><a href="wcwebcamclient_8h.html">wcwebcamclient.h</a></div></div>
<div class="ttc" id="awcwebcamclient_8h_html_a6a8ac7634cc4a78caa52e83769a914c2"><div class="ttname"><a href="wcwebcamclient_8h.html#a6a8ac7634cc4a78caa52e83769a914c2">WC_BASE_TASK</a></div><div class="ttdeci">const wcTaskClass WC_BASE_TASK</div><div class="ttdoc">The Base task class.</div><div class="ttdef"><b>Definition:</b> wcwebcamclient.h:108</div></div>
<div class="ttc" id="awcwebcamclient_8h_html_a75f2ee25f8849ec1859b53ecc06bbff6"><div class="ttname"><a href="wcwebcamclient_8h.html#a75f2ee25f8849ec1859b53ecc06bbff6">WC_IN_STREAM_TASK</a></div><div class="ttdeci">const wcTaskClass WC_IN_STREAM_TASK</div><div class="ttdoc">The Input-stream task class (for GET requests)</div><div class="ttdef"><b>Definition:</b> wcwebcamclient.h:112</div></div>
<div class="ttc" id="awcwebcamclient_8h_html_a8ed09f7b448a852b96e2a705531a285c"><div class="ttname"><a href="wcwebcamclient_8h.html#a8ed09f7b448a852b96e2a705531a285c">wcHandle</a></div><div class="ttdeci">int wcHandle</div><div class="ttdoc">Client handle.</div><div class="ttdef"><b>Definition:</b> wcwebcamclient.h:99</div></div>
<div class="ttc" id="awcwebcamclient_8h_html_a91c112d47f81589bb3ead6630798b831"><div class="ttname"><a href="wcwebcamclient_8h.html#a91c112d47f81589bb3ead6630798b831">wcTask</a></div><div class="ttdeci">wcCallbackTask wcTask</div><div class="ttdoc">Pointer to task.</div><div class="ttdef"><b>Definition:</b> wcwebcamclient.h:102</div></div>
<div class="ttc" id="awcwebcamclient_8h_html_a941706cde2f229a3253a772a2a0598db"><div class="ttname"><a href="wcwebcamclient_8h.html#a941706cde2f229a3253a772a2a0598db">WC_STREAM_FRAME_HEADER_SIZE</a></div><div class="ttdeci">const uint16_t WC_STREAM_FRAME_HEADER_SIZE</div><div class="ttdoc">The size of frame header (6 bytes)</div><div class="ttdef"><b>Definition:</b> wcwebcamclient.h:119</div></div>
<div class="ttc" id="awcwebcamclient_8h_html_ae1ba77ff9ed951c2384f2564b6680760"><div class="ttname"><a href="wcwebcamclient_8h.html#ae1ba77ff9ed951c2384f2564b6680760">wcTaskClass</a></div><div class="ttdeci">uint32_t wcTaskClass</div><div class="ttdoc">Task class.</div><div class="ttdef"><b>Definition:</b> wcwebcamclient.h:105</div></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Apr 22 2024 11:34:33 for wcWebCamClient lib by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
